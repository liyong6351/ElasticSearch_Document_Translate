# 概览

- [回到首页](../readme.md)
- [原始文档](https://www.elastic.co/guide/en/elasticsearch/reference/current/elasticsearch-intro.html)

> 本文档讲解ElasticSearch简介模块的内容

```txt
ES分布式的搜索和分析引擎，它是EStack中的核心。Logstash和Beats有助于收集，聚合和丰富您的数据并将其存储在Elasticsearch
中。Kibana使您能够以交互方式探索，可视化和分享数据洞察，并管理和监控堆栈。数据的搜索工作都发生在Elasticsearch中。

ES提供各种数据的实时搜索和分析能力。无论需要处理的是结构化或非结构化的文本类型、数字类型或坐标类型数据，ES都能快速
有效的索引存储并提供快速的查询能力。你可以使用它远远超出简单的数据检索和聚合信息的能力去发现数据中的趋势和模式。
随着您的数据和查询量的增长，Elasticsearch的分布式特性使您的部署能够与其一起无缝地增长。

虽然不是每个问题都是搜索问题，但Elasticsearch提供了处理各种用例数据的速度和灵活性:
```

- 将搜索框添加到应用或网站
- 存储并分析日志，指标项和安全事件
- 使用机器学习实时自动建模数据行为
- 使用Elasticsearch作为存储引擎自动化业务工作流程
- 使用Elasticsearch作为地理信息系统来管理，集成和分析空间信息(GIS)
- 使用Elasticsearch作为生物信息学研究工具存储和处理遗传数据

```txt
我们对人们使用搜索的新颖方式感到惊讶。但是，无论您的用例是否与其中一个相似，或者您使用Elasticsearch来解决新问题，
您在Elasticsearch中处理数据，文档和索引的方式都是相同的。
```

## 1 数据存储在文档和索引中

```txt
ElasticSearch是一个分布式文档存储组件。不同于按照每列每行的存储模式，ES按照序列化的JSON结构存储复杂的数据结构。
当群集中有多个Elasticsearch节点时，存储的文档将分布在群集中，并且可以从任何节点立即访问到。

当一条文档被存储时，他将立马被索引并且可在接近一秒内提供可搜索能力。ES使用倒排索引的数据结构来支持快速的全文本搜
索能力。倒排索引列出任何文档中出现的每个唯一单词，并标识每个单词出现的所有文档。

索引可以被认为是优化的文档集合并且每个文档都是字段的集合，这些字段是包含数据的键值对。默认情况下，Elasticsearch
会为每个字段中的所有数据编制索引，并且每个索引字段都具有专用的优化数据结构。举例说明: 文本字段存储在反向索引中，
数字和地理字段存储在BKD树中。使用每个字段的数据结构来汇编和返回搜索结果的能力使Elasticsearch如此之快。

Elasticsearch还具有无模式的能力，这意味着无需显式指定如何处理文档中可能出现的每个不同字段而索引文档。当启用动态
映射时,ES会自动检测并且添加新的数据到索引中。这样的默认行为使您可以很方便的索引和处理数据，只需启动索引文档，
Elasticsearch将检测并将布尔值，浮点和整数值，日期和字符串映射到相应的Elasticsearch数据类型。

但是，最终您肯定比Elasticsearch更了解您的数据以及希望如何使用它。您可以定义规则来控制动态映射并显式定义映射，
以完全控制字段的存储和索引方式。

定义自己的映射使您能够：
```

- 区分全文字符串字段和精确值字符串字段
- 执行特定于语言的文本分析
- 优化字段以进行部分匹配
- 使用自定义日期格式
- 使用无法自动检测的数据类型，如geo_point和geo_shape

```txt
为不同目的以不同方式索引相同字段通常很有用。例如: 您可能希望将字符串字段索引为全文搜索的文本字段和用于排序或聚合
数据的关键字字段。或者您可以选择使用多个语言分析器来处理包含用户输入的字符串字段的内容。

在索引期间应用于全文字段的分析链也在搜索时使用。查询全文字段时，查询文本在索引中查找术语之前会进行相同的分析。
```

## 2 信息输出：搜索和分析

```txt
虽然您可以将Elasticsearch用作文档存储并检索文档及其元数据，但真正的强大功能来自于能够轻松访问基于Apache Lucene
搜索引擎库构建的全套搜索功能。

Elasticsearch提供了一个简单，一致的REST API，用于管理集群、索引和搜索数据。出于测试目的，您可以直接从命令行或通
过Kibana中的Developer Console轻松提交请求。从您的应用程序中，您可以使用Elasticsearch客户端作为您选择的语言：
Java、JS、Go、.NET、PHP、Perl、Python或Ruby。
```

### 2.1 搜索数据

```txt
ES REST API支持结构化查询，包括全文查询、复杂查询和这两者的组合查询。结构化查询类似于可以在SQL中构造
的查询类型。比如，你可以在employee索引中查询gender和age字段，但是使用hire_date进行排序。全文查询查找与查询字符
串匹配的所有文档，并按相关度进行排序。

除了搜索单个术语外，您还可以执行短语搜索，相似性搜索和前缀搜索，并获取自动填充建议。

ES同时提供地理空间或其他数字数据的搜索能力。ES将优化数据结构中的非文本数据编入索引，以支持高性能的地
理和数字查询。

您可以使用ES的全面JSON样式查询语言（查询DSL）访问所有这些搜索功能。您还可以构建SQL样式的查询以在ES内本地搜索和聚合数据，
JDBC和ODBC驱动程序使各种第三方应用程序能够通过SQL与ES进行交互。
```

### 2.2 分析数据

```txt
通过ES聚合，您可以构建复杂的数据摘要，并深入了解关键指标，模式和趋势。聚合使您无法找到众所周知的“大海捞针”，
而是回答以下问题：
```

- 海里有多少根针
- 针的平均长度是多少
- 根据制造商细分的针的中位长度是多少
- 在过去的六个月中，每片海中都添加了多少针

```txt
您还可以使用聚合来回答更微妙的问题，例如：
```

- 你最受欢迎的针头制造商是什么
- 是否有任何异常的针头

```txt
由于聚合利用了用于搜索的相同数据结构，因此它们也非常快。这使您可以实时分析和可视化数据。您的报告和仪表板会随着
数据更改而更新，以便您可以根据最新信息采取措施。

更重要的是，聚合与搜索请求一起运行。您可以在同一数据中，在单个请求中同时搜索文档，过滤结果和执行分析。并且因为
聚合是在特定搜索的上下文中计算的,您显示的是与针对用户搜索条件匹配的70厘米针的数量。
```

### 2.3 其他处理

```txt
想要自动分析您的时间序列数据？您可以使用机器学习功能在数据中创建正常行为的准确基线，并识别异常模式。通过机器学习，
您可以检测到：
```

- 与值，计数或频率的时间偏差相关的异常
- 统计数据
- 操作异常

```txt
最好的部分？您无需指定算法，模型或其他与数据科学相关的配置即可完成此操作。
```

## 3 可扩展性和弹性

### 3.1 扩展性和弹性: 集群、节点和分片

```txt
ES设计初衷就是要提高系统的可使用性，同时支持按需配置的需求。通过分布式他能自然的做到上述的能力。你可以往集群中
添加服务器(节点)用来增加容量，ES会自动的将你新增加的节点加入到集群中并且提供横向的查询功能。无需重启应用程序，ES
就知道怎么去将多节点的集群提供弹性和高可用。当然节点越多越好

那么他们是怎么工作的呢? Elasticsearch索引实际上只是一个或多个物理分片的逻辑分组，其中每个分片实际上是一个自包含
的索引。索引中的文档会分发到多个分片，这些分片也会分布在多个节点上，这样ES可确保冗余，这可以防止硬件故障，并在节点
添加到群集时提高查询容量。随着集群的扩大(或收缩)，ES会自动迁移分片以重新平衡集群。

存在两种形式的分片: 主分片和副本。索引中的每个文档都属于某个主分片。副本是主分片的拷贝信息。副本提供数据的冗余，
以防止硬件故障并增加服务读取请求（如搜索或检索文档）的容量。

索引中的主分片数在创建索引时是固定的，但是可以随时更改副本分片的数量，而不会中断索引或查询操作。
```

### 3.2 依赖的能力

```txt
分片大小和配置的主分片数量，存在许多性能考虑因素和折衷方案。分片越多，维护这些索引的开销就越大。分片大小越大，
当Elasticsearch需要重新平衡群集时，移动分片所需的时间越长。

查询大量小分片使得每个分片的处理速度更快，但查询意味着更多的开销，因此查询较少数量的较大分片可能会更快。
这取决于以下几个方面:
```

- 旨在将平均分片大小保持在几GB到几十GB之间。对于具有基于时间的数据的用例，通常会看到20GB到40GB范围内的分片。
- 避免大量碎片问题。节点可以容纳的分片数量与可用堆空间成比例。作为一般规则，每GB堆空间的分片数应小于20。

```txt
确定用例的最佳配置的最佳方法是通过自己的基准测试，对应的链接地址为:
https://www.elastic.co/elasticon/conf/2016/sf/quantitative-cluster-sizing
```

### 3.3 如果发生灾难

```txt
出于性能原因，群集中的节点需要位于同一内网上。在不同数据中心的节点和分片之间做数据的平衡会耗费很长时间。但是高可
用性架构要求您避免将所有鸡蛋放在一个篮子里。如果在一个位置发生状况，则另一个服务器需要能够无缝接管。这时候就需要
跨群集复制能力（CCR: cross-cluster replication）

CCR提供了一种自动将索引从主群集同步到可作为热备份的辅助远程群集的方法。如果主集群发生了错误，那么备用集群可及时
顶上。您还可以使用CCR创建辅助群集，以便在地理位置接近用户时提供读取请求。

CCR是主动 -> 被动的。主节点上的索引是活动的leader索引并处理所有写入请求。复制到的辅助索引是只读的follower。
```

### 3.4 管理和运维

```txt
与任何企业系统一样，您需要工具来保护，管理和监控您的ES集群。 集成到ES中的安全性，监控和管理功能使您可以将Kibana
用作管理集群的控制中心。 数据汇总和索引生命周期管理等功能可帮助您智能地管理数据。
```